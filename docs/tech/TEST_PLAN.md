# 测试计划 (Test Plan)

## 项目概述

**项目名称**: 重生到火影忍者世界游戏
**测试范围**: 前端Flutter应用 + 后端Node.js API
**测试负责人**: QA Team
**文档版本**: 1.0
**最后更新**: 2026-02-13

---

## 1. 测试目标

1. 确保游戏核心功能正确性和稳定性
2. 达到至少70%的代码覆盖率
3. 验证前后端数据交互的正确性
4. 确保用户数据的安全性和完整性
5. 保证游戏在不同场景下的性能表现

---

## 2. 测试范围

### 2.1 前端测试（Flutter）

#### 单元测试
- **数据模型测试** (`test/models/`)
  - StoryNode模型
  - Save模型
  - Player模型
  - Quest模型
  - Item模型

- **服务测试** (`test/services/`)
  - HiveService（本地存储）
  - ApiService（网络请求）

- **Provider测试** (`test/providers/`)
  - GameProvider（游戏状态管理）
  - PlayerProvider（玩家数据管理）
  - StoryProvider（剧情管理）
  - ShopProvider（商店管理）

#### Widget测试
- **核心界面测试** (`test/widgets/`)
  - 启动页（SplashScreen）
  - 登录/注册界面
  - 存档/读档界面
  - 剧情展示界面
  - 任务界面
  - 商店界面
  - 属性界面

#### 集成测试
- 用户注册/登录流程
- 存档上传/下载流程
- 剧情节点加载与导航
- 任务完成流程
- 商店购买流程

### 2.2 后端测试（Node.js）

#### 单元测试
- **模型测试** (`test/models/`)
  - User模型
  - Save模型
  - StoryNode模型
  - Quest模型
  - Item模型

- **路由测试** (`test/routes/`)
  - 认证路由 (`/api/auth`)
  - 玩家路由 (`/api/player`)
  - 存档路由 (`/api/saves`)
  - 剧情路由 (`/api/story`)
  - 任务路由 (`/api/quests`)
  - 商店路由 (`/api/shop`)

#### 集成测试
- 用户注册/登录API
- 存档CRUD操作
- 剧情节点加载
- 任务状态更新
- 商店交易处理
- 数据库事务处理

#### API测试
- 请求/响应格式验证
- 错误处理和状态码
- API性能测试
- 并发请求处理

---

## 3. 测试环境

### 3.1 前端测试环境
- **框架**: Flutter Test
- **覆盖工具**: flutter test --coverage
- **Mock框架**: mockito
- **版本**: Flutter SDK 3.x

### 3.2 后端测试环境
- **框架**: Jest + ts-jest
- **HTTP测试**: supertest
- **数据库**: MongoDB (测试实例)
- **Node版本**: v18.x+

### 3.3 测试数据
- 测试用户账户
- 测试存档数据
- 测试剧情节点
- 测试任务和物品

---

## 4. 测试策略

### 4.1 单元测试策略
- 隔离测试每个独立模块
- 使用Mock对象替代外部依赖
- 覆盖正常流程和异常情况
- 测试边界条件和极端值

### 4.2 集成测试策略
- 测试模块间的交互
- 测试数据库CRUD操作
- 验证API端点完整性
- 测试事务处理

### 4.3 Widget测试策略
- 测试UI组件渲染
- 测试用户交互响应
- 测试状态变化更新
- 验证UI布局正确性

### 4.4 性能测试策略
- 测试API响应时间
- 测试数据库查询性能
- 测试界面加载速度
- 监控内存使用情况

---

## 5. 测试用例设计

### 5.1 前端测试用例

#### StoryNode模型测试
- ✓ 创建有效StoryNode
- ✓ 创建带选择的StoryNode
- ✓ 序列化/反序列化测试
- ✓ 处理空值和默认值
- ✓ 多个StoryChoice验证

#### Save模型测试
- ✓ 创建完整存档数据
- ✓ 属性值边界测试
- ✓ 库存、任务、成就管理
- ✓ 时间戳处理
- ✓ copyWith方法测试

#### GameProvider测试
- ✓ 初始状态验证
- ✓ 暂停/恢复游戏
- ✓ 加载状态管理
- ✓ 游戏时间更新
- ✓ 通知监听器

#### PlayerProvider测试
- ✓ 属性增减测试
- ✓ 等级和经验管理
- ✓ 章节更新
- ✓ 货币交易
- ✓ 重置玩家数据

### 5.2 后端测试用例

#### User模型测试
- ✓ 用户创建验证
- ✓ 必填字段检查
- ✓ 唯一性约束验证
- ✓ 字段约束测试（长度、格式）
- ✓ CRUD操作测试

#### StoryNode模型测试
- ✓ 节点创建验证
- ✓ 类型枚举验证
- ✓ 选择项验证
- ✓ 索引验证
- ✓ 复杂查询测试

#### Save模型测试
- ✓ 存档创建和验证
- ✓ 默认值测试
- ✓ 属性嵌套结构
- ✓ 库存和任务管理
- ✓ 云存档标识

---

## 6. 覆盖率目标

| 模块 | 行覆盖率 | 分支覆盖率 | 函数覆盖率 |
|------|---------|-----------|-----------|
| 前端Models | 90% | 85% | 90% |
| 前端Providers | 85% | 80% | 85% |
| 前端Widgets | 80% | 75% | 80% |
| 后端Models | 90% | 85% | 90% |
| 后端Routes | 80% | 75% | 80% |
| **总体** | **70%** | **65%** | **70%** |

---

## 7. 测试执行计划

### 7.1 测试阶段

#### 第一阶段：单元测试（2026-02-13）
- 完成所有模型测试
- 完成Provider测试
- 完成后端路由测试

#### 第二阶段：Widget测试（2026-02-14）
- 完成核心界面测试
- 验证UI交互
- 测试状态管理

#### 第三阶段：集成测试（2026-02-15）
- 测试前后端集成
- 测试数据库操作
- 测试API端到端流程

#### 第四阶段：性能测试（2026-02-16）
- 负载测试
- 压力测试
- 内存泄漏检测

### 7.2 回归测试
- 每次代码更新后执行相关测试
- 每周执行完整测试套件
- 发布前执行所有测试

---

## 8. 缺陷管理

### 8.1 缺陷级别
- **P0 - 致命**: 系统崩溃、数据丢失
- **P1 - 严重**: 核心功能不可用
- **P2 - 中等**: 功能部分异常
- **P3 - 轻微**: UI小问题、提示信息错误

### 8.2 缺陷报告格式
```
[缺陷ID] 标题
- 优先级: Px
- 严重程度: Sx
- 复现步骤: ...
- 期望结果: ...
- 实际结果: ...
- 环境信息: ...
```

---

## 9. 测试交付物

1. **测试用例文档** - 所有测试用例的详细描述
2. **测试结果报告** - 测试执行结果和覆盖率报告
3. **缺陷报告** - 发现的所有缺陷及修复状态
4. **覆盖率报告** - 代码覆盖率详细数据
5. **性能测试报告** - 性能指标和瓶颈分析

---

## 10. 风险与缓解

| 风险 | 影响 | 缓解措施 |
|------|------|---------|
| 测试数据不足 | 无法覆盖所有场景 | 准备多样化的测试数据集 |
| Mock对象不准确 | 测试结果不可靠 | 定期验证Mock行为 |
| 数据库连接不稳定 | 集成测试失败 | 使用内存数据库进行单元测试 |
| 测试时间不足 | 无法完成所有测试 | 优先级排序，先测试核心功能 |

---

## 11. 附录

### 11.1 参考文档
- Flutter Testing Documentation
- Jest Documentation
- 项目技术文档
- API文档

### 11.2 术语表
- **Unit Test**: 单元测试
- **Integration Test**: 集成测试
- **Widget Test**: Widget测试
- **Coverage**: 覆盖率
- **Mock**: 模拟对象
- **Stub**: 存根
